<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SmileCare â€“ Fun Puzzle</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<!-- TOP BANNER -->
<div class="bg-primary bg-gradient text-white text-center py-5 mb-4">
  <h1 class="fw-bold">ðŸ§© Fun Smile Puzzle</h1>
  <p class="lead">Drag the tiles and rebuild the picture!</p>

  <!-- SHUFFLE BUTTON -->
  <button id="shuffleBtn" class="btn btn-light fw-bold mt-2">Shuffle Puzzle</button>
</div>

<!-- PUZZLE CARD -->
<div class="container">
  <div class="card shadow-lg p-3 mb-5">
    <div class="card-body">
      <!-- PUZZLE GRID WRAPPER -->
      <div class="d-flex justify-content-center">
        <div id="puzzle" class="row g-1 border rounded p-2 bg-white" style="max-width:350px; width:100%;">
        </div>
      </div>

    </div>
  </div>
</div>

<!-- RETURN HOME BUTTON -->
<div class="container text-center my-5">
  <a href="index.html" class="btn btn-secondary btn-lg px-5">Return to Home</a>
</div>

<!-- BOOTSTRAP JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- PUZZLE SCRIPT WITH DETAILED LINE-BY-LINE COMMENTS -->
<script>
  // Get puzzle container
  const puzzle = document.getElementById('puzzle');

  // Create array [0â€“8] representing correct positions
  let order = [...Array(9).keys()];

  // Randomize it
  shuffle(order);

  // Draw tiles for the first time
  createTiles();

  // Store dragged tile
  let draggedTile;

  // Rebuild puzzle on window resize
  window.addEventListener("resize", createTiles);

  // Shuffle button functionality
  document.getElementById("shuffleBtn").addEventListener("click", () => {
    order = [...Array(9).keys()];
    shuffle(order);
    createTiles();
  });

  /* =============================
     FUNCTION: createTiles()
     Builds the puzzle tiles
     ============================= */
  function createTiles() {
    // Clear old tiles
    puzzle.innerHTML = "";

    // Calculate square tile size
    let size = puzzle.clientWidth / 3;

    // Loop through shuffled order array
    order.forEach(pos => {

      // Create a tile div
      let tile = document.createElement("div");

      // Make it 1/3 width using col-4 & add border
      tile.className = "col-4 border";

      // Make draggable
      tile.draggable = true;

      // Store correct position
      tile.dataset.pos = pos;

      // Set the height dynamically
      tile.style.height = size + "px";

      // Set puzzle image
      tile.style.backgroundImage = "url('puzzle.jpg')";

      // Define full background size (3Ã—3 grid)
      tile.style.backgroundSize = (size * 3) + "px " + (size * 3) + "px";

      // Set correct slice of image
      tile.style.backgroundPosition =
        `${-(pos % 3) * size}px ${-Math.floor(pos / 3) * size}px`;

      // Attach drag listeners
      tile.addEventListener("dragstart", dragStart);
      tile.addEventListener("dragover", dragOver);
      tile.addEventListener("drop", dropTile);

      // Add tile to puzzle grid
      puzzle.appendChild(tile);
    });
  }

  /* =============================
     DRAG FUNCTIONS
     ============================= */

  // Save which tile is being dragged
  function dragStart(e) {
    draggedTile = e.target;
  }

  // Allow drop
  function dragOver(e) {
    e.preventDefault();
  }

  // Swap tiles when dropped
  function dropTile(e) {
    e.preventDefault();

    if (draggedTile === e.target) return;

    let tempBg = e.target.style.backgroundPosition;
    let tempPos = e.target.dataset.pos;

    e.target.style.backgroundPosition = draggedTile.style.backgroundPosition;
    e.target.dataset.pos = draggedTile.dataset.pos;

    draggedTile.style.backgroundPosition = tempBg;
    draggedTile.dataset.pos = tempPos;

    checkWin();
  }

  /* =============================
     CHECK IF SOLVED
     ============================= */
  function checkWin() {
    let tiles = document.querySelectorAll("#puzzle > div");

    let solved = Array.from(tiles).every((tile, index) =>
      tile.dataset.pos == index
    );

    if (solved) {
      setTimeout(() => alert("ðŸŽ‰ Puzzle completed! Amazing job!"), 200);
    }
  }

  /* =============================
     SHUFFLE FUNCTION
     ============================= */
  function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      let j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
  }
</script>

</body>
</html>
